# ğŸ— æ¶æ„è®¾è®¡ â€” æ–‡æ¡£è¯·æ±‚ç³»ç»Ÿ

> **æŠ€æœ¯æ¶æ„æ–‡æ¡£**
>
> ç‰ˆæœ¬: 1.0 Â· æ—¥æœŸ: 2026-02-19 Â· çŠ¶æ€: è®¾è®¡ä¸­

---

## ğŸ“‘ ç›®å½•

- [æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
- [é«˜å±‚æ¶æ„å›¾](#2-é«˜å±‚æ¶æ„å›¾)
- [ç³»ç»Ÿç»„ä»¶](#3-ç³»ç»Ÿç»„ä»¶)
- [æ•°æ®æ¨¡å‹](#4-æ•°æ®æ¨¡å‹)
- [API â€” ä¸»è¦ç«¯ç‚¹](#5-api--ä¸»è¦ç«¯ç‚¹)
- [Power Automate æµç¨‹ â€” è¯¦ç»†è®¾è®¡](#6-power-automate-æµç¨‹--è¯¦ç»†è®¾è®¡)
- [è®¤è¯ä¸æˆæƒ](#7-è®¤è¯ä¸æˆæƒ)
- [å­˜å‚¨ä¸å½’æ¡£](#8-å­˜å‚¨ä¸å½’æ¡£)
- [ç»„ä»¶é—´é€šä¿¡](#9-ç»„ä»¶é—´é€šä¿¡)
- [çŠ¶æ€ä¸çŠ¶æ€æœº](#10-çŠ¶æ€ä¸çŠ¶æ€æœº)
- [æ¶æ„å†³ç­– (ADR)](#11-æ¶æ„å†³ç­–-adr)
- [å¤‡é€‰æ–¹æ¡ˆè¯„ä¼°](#12-å¤‡é€‰æ–¹æ¡ˆè¯„ä¼°)
- [éåŠŸèƒ½æ€§éœ€æ±‚](#13-éåŠŸèƒ½æ€§éœ€æ±‚)
- [éƒ¨ç½²è®¡åˆ’](#14-éƒ¨ç½²è®¡åˆ’)
- [å¯è§‚æµ‹æ€§ä¸ç›‘æ§](#15-å¯è§‚æµ‹æ€§ä¸ç›‘æ§)
- [é£é™©ä¸ç¼“è§£](#16-é£é™©ä¸ç¼“è§£)

---

## 1. æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒåŸåˆ™

> **Power Automate å……å½“ "æˆæƒä»£ç†"** è¿æ¥ Microsoft 365 ç”Ÿæ€ç³»ç»Ÿï¼Œæ¶ˆé™¤äº†å¯¹å…¨çƒ IT æƒé™ï¼ˆAzure AD åº”ç”¨æ³¨å†Œã€Graph API ç­‰ï¼‰çš„éœ€æ±‚ã€‚

### æ¶æ„é£æ ¼

ç³»ç»Ÿé‡‡ç”¨**å¸¦æœ‰è‡ªåŠ¨åŒ–ä¸­é—´ä»¶çš„ä¸‰å±‚æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ç”¨æˆ·å±‚                                               â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å‘èµ·äºº          â”‚    â”‚   æ¥æ”¶äºº              â”‚    â”‚   ç®¡ç†å‘˜ / å®¡è®¡å‘˜    â”‚  â”‚
â”‚  â”‚   (æ§åˆ¶è´Ÿè´£äºº)    â”‚    â”‚   (ç»ç† / åˆä¼™äºº)     â”‚    â”‚   (ä¸»ç®¡)             â”‚  â”‚
â”‚  â”‚                  â”‚    â”‚   (Manager / Socio)  â”‚    â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚  åº”ç”¨ç™»å½•                â”‚ å‡­è¯åŒ–é“¾æ¥                 â”‚ åº”ç”¨ç™»å½•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                          â”‚                            â”‚
            â–¼                          â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¡¨ç°å±‚ (PRESENTATION LAYER)                             â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        å‰ç«¯ (SPA)                                           â”‚ â”‚
â”‚  â”‚  â€¢ æ´»åŠ¨å’Œè¯·æ±‚é¢æ¿                                                           â”‚ â”‚
â”‚  â”‚  â€¢ åˆ›å»ºå’Œé…ç½®è¡¨å•                                                           â”‚ â”‚
â”‚  â”‚  â€¢ æ¥æ”¶äººä¸Šä¼ é—¨æˆ·                                                           â”‚ â”‚
â”‚  â”‚  â€¢ åŒ…å« KPI å’ŒæŠ¥å‘Šçš„ä»ªè¡¨ç›˜                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ REST API (HTTPS)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸šåŠ¡å±‚ (BUSINESS LAYER)                                 â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     åç«¯ (API Server)                                       â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Campaign     â”‚ â”‚  Request     â”‚ â”‚  Evidence    â”‚ â”‚  Auth & Token    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  Service      â”‚ â”‚  Service     â”‚ â”‚  Service     â”‚ â”‚  Service         â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Reminder     â”‚ â”‚  Audit Log   â”‚ â”‚  Report      â”‚ â”‚  Notification    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  Engine       â”‚ â”‚  Service     â”‚ â”‚  Generator   â”‚ â”‚  Dispatcher      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ SQL                             â”‚ HTTP Webhooks
                â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®å±‚ (DATA LAYER)     â”‚    â”‚         é›†æˆå±‚ (INTEGRATION LAYER)              â”‚
â”‚                           â”‚    â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    PostgreSQL        â”‚ â”‚    â”‚  â”‚           Power Automate                    â”‚ â”‚
â”‚  â”‚                      â”‚ â”‚    â”‚  â”‚                                             â”‚ â”‚
â”‚  â”‚  â€¢ Campaigns (æ´»åŠ¨)  â”‚ â”‚    â”‚  â”‚  Flow 1: å‘é€åˆå§‹è¯·æ±‚            (HTTP)      â”‚ â”‚
â”‚  â”‚  â€¢ Requests (è¯·æ±‚)   â”‚ â”‚    â”‚  â”‚  Flow 2: å‘é€ OTP               (HTTP)      â”‚ â”‚
â”‚  â”‚  â€¢ Evidence Items    â”‚ â”‚    â”‚  â”‚  Flow 3: æé†’ä¸å‡çº§              (Sched)     â”‚ â”‚
â”‚  â”‚  â€¢ Submissions       â”‚ â”‚    â”‚  â”‚  Flow 4: å½’æ¡£ä¸å…³é—­              (HTTP)      â”‚ â”‚
â”‚  â”‚  â€¢ Audit Logs        â”‚ â”‚    â”‚  â”‚                                             â”‚ â”‚
â”‚  â”‚  â€¢ Users / Tokens    â”‚ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚                      â”‚ Outlook / SharePoint       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                      â–¼ è¿æ¥å™¨                    â”‚
                                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                â”‚  â”‚         Microsoft 365                        â”‚ â”‚
                                â”‚  â”‚                                             â”‚ â”‚
                                â”‚  â”‚  â€¢ Outlook (å‘é€é‚®ä»¶)                       â”‚ â”‚
                                â”‚  â”‚  â€¢ SharePoint (æ–‡æ¡£å­˜å‚¨)                    â”‚ â”‚
                                â”‚  â”‚  â€¢ OneDrive (å¯é€‰å¤‡ä»½)                      â”‚ â”‚
                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. é«˜å±‚æ¶æ„å›¾

### ä¸»è¦æ•°æ®æµ

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    å‘èµ·äºº (è´Ÿè´£äºº)          â”‚
                        â”‚    åˆ›å»ºæ´»åŠ¨å’Œè¯·æ±‚           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                               â”‚   åç«¯       â”‚
                               â”‚  API Server  â”‚
                               â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                                  â”‚       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PostgreSQL   â”‚   â”‚  Power Automate    â”‚
                    â”‚  (æ•°æ®)       â”‚   â”‚  (é‚®ä»¶/æ–‡ä»¶)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                                             â”‚          â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  Outlook    â”‚  â”‚  SharePoint    â”‚
                                   â”‚  (é‚®ä»¶)     â”‚  â”‚  (å‡­è¯)        â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  æ¥æ”¶äºº (Manager)         â”‚
                              â”‚  æ”¶åˆ°é‚®ä»¶ â†’ é€šè¿‡          â”‚
                              â”‚  å‡­è¯åŒ–é“¾æ¥è®¿é—®           â”‚
                              â”‚  â†’ ä¸Šä¼ æ–‡æ¡£               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç³»ç»Ÿç»„ä»¶

### 3.1 å‰ç«¯ (SPA)

**èŒè´£:** å‘èµ·äººã€æ¥æ”¶äººå’Œä¸»ç®¡çš„ç”¨æˆ·ç•Œé¢ã€‚

| æ¨¡å— | æè¿° | ç”¨æˆ· |
|---|---|---|
| **CampaignManager** | åˆ›å»ºã€ç¼–è¾‘å’ŒæŸ¥çœ‹æ´»åŠ¨ | å‘èµ·äºº |
| **RequestBuilder** | åˆ†é…æ¥æ”¶äººå’Œå‡­è¯ (A/B æ¨¡å¼) | å‘èµ·äºº |
| **RequestPreview** | å‘é€å‰çš„å®¡æŸ¥å’Œè°ƒæ•´ | å‘èµ·äºº |
| **SubmitPortal** | æ–‡æ¡£ä¸Šä¼ é—¨æˆ· (å‡­è¯åŒ–è®¿é—®) | æ¥æ”¶äºº |
| **ReviewPanel** | éªŒè¯/æ‹’ç»æ”¶åˆ°çš„å‡­è¯ | å‘èµ·äºº |
| **Dashboard** | KPIã€ç»Ÿè®¡æ•°æ®ã€æ—¶é—´çº¿å’Œå¯¼å‡º | å‘èµ·äºº, ä¸»ç®¡ |
| **AuditViewer** | æŸ¥è¯¢ä¸å¯å˜çš„äº‹ä»¶è®°å½• | ä¸»ç®¡, å®¡è®¡å‘˜ |

**æ¨èæŠ€æœ¯:**

```
React 18+ / Next.js 14+
â”œâ”€â”€ UI Library: shadcn/ui æˆ– Ant Design (ä¸“ä¸šç»„ä»¶)
â”œâ”€â”€ State Management: Zustand æˆ– React Query
â”œâ”€â”€ Routing: React Router / Next.js App Router
â”œâ”€â”€ Forms: React Hook Form + Zod éªŒè¯
â”œâ”€â”€ Charts: Recharts æˆ– Nivo (ä»ªè¡¨ç›˜ KPI)
â”œâ”€â”€ Tables: TanStack Table (æ´»åŠ¨/è¯·æ±‚åˆ—è¡¨)
â”œâ”€â”€ File Upload: react-dropzone
â””â”€â”€ i18n: react-intl / next-intl (æœªæ¥å¤šè¯­è¨€æ”¯æŒ)
```

### 3.2 åç«¯ (API Server)

**èŒè´£:** ä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€ä»¤ç‰Œå’Œæµç¨‹ç¼–æ’ã€‚

| æœåŠ¡ | èŒè´£ |
|---|---|
| **CampaignService** | æ´»åŠ¨çš„ CRUDã€çŠ¶æ€æ›´æ”¹ã€ç­–ç•¥ |
| **RequestService** | ç”Ÿæˆã€å‘é€ã€è¡¥æ­£å’Œå…³é—­è¯·æ±‚ |
| **EvidenceService** | ç®¡ç†æ¯ä¸ªå‡­è¯çš„ç”Ÿå‘½å‘¨æœŸ |
| **SubmissionService** | è®°å½•éƒ¨åˆ†å’Œå®Œæ•´æäº¤ |
| **TokenService** | ç”Ÿæˆã€ç­¾åå’ŒéªŒè¯ JWT/HMAC ä»¤ç‰Œ |
| **OTPService** | ç”Ÿæˆã€å‘é€å’ŒéªŒè¯ OTP ä»£ç  |
| **ReminderEngine** | è®¡ç®—å¾…å¤„ç†çš„æé†’å’Œå‡çº§çº§åˆ« |
| **NotificationDispatcher** | é€šè¿‡ HTTP webhooks ä¸ Power Automate é€šä¿¡ |
| **AuditLogService** | ä¸å¯å˜åœ°è®°å½•æ‰€æœ‰ç³»ç»Ÿäº‹ä»¶ |
| **ReportGenerator** | ç”Ÿæˆå®¡è®¡æŠ¥å‘Š (PDF/Excel) |

**æ¨èæŠ€æœ¯:**

```
Node.js 20 LTS + Express / NestJS
â”œâ”€â”€ ORM: Prisma æˆ– TypeORM
â”œâ”€â”€ éªŒè¯: Zod / class-validator
â”œâ”€â”€ è®¤è¯ä»¤ç‰Œ: jsonwebtoken (JWT) + crypto (HMAC)
â”œâ”€â”€ HTTP å®¢æˆ·ç«¯: axios (è°ƒç”¨ Power Automate)
â”œâ”€â”€ PDF ç”Ÿæˆ: PDFKit / Puppeteer
â”œâ”€â”€ é€Ÿç‡é™åˆ¶: express-rate-limit
â”œâ”€â”€ æ—¥å¿—: Winston / Pino
â”œâ”€â”€ æµ‹è¯•: Jest + Supertest
â””â”€â”€ API æ–‡æ¡£: Swagger / OpenAPI 3.0
```

### 3.3 æ•°æ®åº“ (PostgreSQL)

**èŒè´£:** ç³»ç»Ÿæ‰€æœ‰æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚

**é€‰æ‹© PostgreSQL çš„åŸå› :**
- åŸç”Ÿæ”¯æŒ JSONB ä»¥å­˜å‚¨çµæ´»æ•°æ®ï¼ˆè¯´æ˜ã€å…ƒæ•°æ®ï¼‰
- ACID äº‹åŠ¡ç¡®ä¿å®¡è®¡æ—¥å¿—çš„å®Œæ•´æ€§
- é€šè¿‡åªè¯»å‰¯æœ¬å®ç°æ°´å¹³æ‰©å±•
- æ”¯æŒçª—å£å‡½æ•°ç”¨äºè®¡ç®— KPI
- `pgcrypto` ç­‰æ‰©å±•ç”¨äºä»¤ç‰Œå¤„ç†

### 3.4 Power Automate (é›†æˆå±‚)

**èŒè´£:** åº”ç”¨ç¨‹åºä¸ Microsoft 365 ä¹‹é—´çš„æˆæƒæ¡¥æ¢ã€‚

**ä¸ºä»€ä¹ˆé€‰æ‹© Power Automate?**
- âœ… æ— éœ€åœ¨ Azure AD ä¸­æ³¨å†Œåº”ç”¨ç¨‹åº
- âœ… ä½¿ç”¨æµåˆ›å»ºè€…çš„å‡­æ®
- âœ… HTTP è§¦å‘å™¨å…è®¸æ— éœ€é¢å¤–é…ç½®æ¥æ”¶ API è°ƒç”¨
- âœ… åŸç”Ÿçš„ Outlook å’Œ SharePoint è¿æ¥å™¨
- âœ… æ¯æ—¥æé†’çš„è®¡åˆ’æ‰§è¡Œ
- âš ï¸ é™åˆ¶: é‚®ä»¶ä»æµåˆ›å»ºè€…çš„è´¦æˆ·ï¼ˆæˆ–å…±äº«é‚®ç®±ï¼‰å‘é€

### 3.5 SharePoint (æ–‡æ¡£å­˜å‚¨)

**èŒè´£:** å‡­è¯å’ŒæŠ¥å‘Šçš„ç»“æ„åŒ–å’ŒæŒä¹…åŒ–å­˜å‚¨ã€‚

---

## 4. æ•°æ®æ¨¡å‹

### 4.1 å®ä½“å…³ç³»å›¾ (ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CAMPAIGN         â”‚     â”‚         USER              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK campaign_id (UUID)â”‚     â”‚ PK user_id (UUID)         â”‚
â”‚    name               â”‚     â”‚    email                  â”‚
â”‚    control_code        â”‚     â”‚    display_name           â”‚
â”‚    description         â”‚     â”‚    role (enum)            â”‚
â”‚ FK owner_user_id       â”‚â—„â”€â”€â”€â”€â”‚    department             â”‚
â”‚ FK backup_user_id      â”‚     â”‚    created_at             â”‚
â”‚    start_date          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    end_date            â”‚
â”‚    reminder_policy     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    escalation_policy   â”‚     â”‚     EVIDENCE_TEMPLATE     â”‚
â”‚    email_template      â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    status (enum)       â”‚     â”‚ PK template_id (UUID)     â”‚
â”‚    created_at          â”‚     â”‚    name                   â”‚
â”‚    updated_at          â”‚     â”‚    category               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚    type (enum)             â”‚
â”‚ 1:N â†’ REQUEST         â”‚     â”‚    default_instructions   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    is_global               â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        REQUEST            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK request_id (UUID)      â”‚
â”‚ FK campaign_id             â”‚
â”‚    recipient_email         â”‚
â”‚    recipient_name          â”‚
â”‚    cc_emails (JSONB)       â”‚
â”‚    delegate_email          â”‚
â”‚    deadline                â”‚
â”‚    status (enum)           â”‚
â”‚    token_hash              â”‚
â”‚    token_expires_at        â”‚
â”‚    reminder_count          â”‚
â”‚    last_reminder_at        â”‚
â”‚    escalation_level        â”‚
â”‚    created_at              â”‚
â”‚    updated_at              â”‚
â”‚    closed_at               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1:N â†’ EVIDENCE_ITEM       â”‚
â”‚ 1:N â†’ SUBMISSION           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     EVIDENCE_ITEM         â”‚     â”‚       SUBMISSION         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK evidence_id (UUID)     â”‚     â”‚ PK submission_id (UUID)  â”‚
â”‚ FK request_id              â”‚     â”‚ FK request_id             â”‚
â”‚ FK template_id (nullable)  â”‚     â”‚    submitted_by_email     â”‚
â”‚    name                    â”‚     â”‚    submitted_at           â”‚
â”‚    type (enum)             â”‚     â”‚    ip_address             â”‚
â”‚    is_mandatory            â”‚     â”‚    user_agent             â”‚
â”‚    instructions (TEXT)     â”‚     â”‚    notes                  â”‚
â”‚    status (enum)           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    rejection_reason        â”‚              â”‚
â”‚    validated_by            â”‚              â”‚ 1:N
â”‚    validated_at            â”‚              â–¼
â”‚    file_sp_path            â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    file_sp_url             â”‚     â”‚     SUBMISSION_FILE      â”‚
â”‚    file_size_bytes         â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    file_mime_type          â”‚     â”‚ PK file_id (UUID)         â”‚
â”‚    created_at              â”‚     â”‚ FK submission_id           â”‚
â”‚    updated_at              â”‚     â”‚ FK evidence_id             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    original_filename       â”‚
                                  â”‚    stored_filename          â”‚
                                  â”‚    mime_type                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    size_bytes               â”‚
â”‚       AUDIT_LOG           â”‚     â”‚    sp_path                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚    sp_url                   â”‚
â”‚ PK log_id (UUID)          â”‚     â”‚    uploaded_at              â”‚
â”‚    entity_type (enum)     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    entity_id (UUID)       â”‚
â”‚    action (enum)          â”‚
â”‚    actor_email            â”‚
â”‚    actor_ip               â”‚
â”‚    timestamp              â”‚
â”‚    details (JSONB)        â”‚
â”‚    campaign_id (denorm.)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æšä¸¾ (Enums)

#### Campaign Status (æ´»åŠ¨çŠ¶æ€)
```
DRAFT (è‰ç¨¿) â†’ ACTIVE (è¿›è¡Œä¸­) â†’ COMPLETED (å·²å®Œæˆ) â†’ ARCHIVED (å·²å½’æ¡£)
```

#### Request Status (è¯·æ±‚çŠ¶æ€)
```
DRAFT (è‰ç¨¿) â†’ SENT (å·²å‘é€) â†’ IN_PROGRESS (è¿›è¡Œä¸­) â†’ PARTIAL (éƒ¨åˆ†æäº¤) 
  â†’ SUBMITTED (å·²æäº¤) â†’ REVIEW (å®¡æŸ¥ä¸­)
  â†’ READY_TO_CLOSE (å¯å…³é—­) â†’ CLOSED (å·²å…³é—­)
  â†’ OVERDUE (é€¾æœŸ - æ ¹æ®æˆªæ­¢æ—¥æœŸè‡ªåŠ¨ç”Ÿæˆ)
```

#### Evidence Status (å‡­è¯çŠ¶æ€)
```
PENDING (å¾…å¤„ç†) â†’ SUBMITTED (å·²æäº¤) â†’ VALIDATED (å·²éªŒè¯) â†’ REJECTED (å·²æ‹’ç»)
  (REJECTED çŠ¶æ€å¯é€šè¿‡è¡¥æ­£å›åˆ° PENDING)
```

#### Audit Actions (å®¡è®¡æ“ä½œ)
```
CAMPAIGN_CREATED, CAMPAIGN_UPDATED, CAMPAIGN_ACTIVATED, CAMPAIGN_COMPLETED
REQUEST_CREATED, REQUEST_SENT, REQUEST_REMINDER_SENT, REQUEST_ESCALATED
REQUEST_CLOSED
EVIDENCE_SUBMITTED, EVIDENCE_VALIDATED, EVIDENCE_REJECTED
SUBMISSION_CREATED
TOKEN_GENERATED, TOKEN_VALIDATED, TOKEN_EXPIRED
OTP_SENT, OTP_VALIDATED, OTP_FAILED
FILE_UPLOADED, FILE_ARCHIVED_SP
```

### 4.3 æ¨èç´¢å¼•

```sql
-- å¸¸ç”¨æŸ¥è¯¢
CREATE INDEX idx_request_campaign ON request(campaign_id);
CREATE INDEX idx_request_status ON request(status);
CREATE INDEX idx_request_deadline ON request(deadline);
CREATE INDEX idx_request_recipient ON request(recipient_email);
CREATE INDEX idx_evidence_request ON evidence_item(request_id);
CREATE INDEX idx_evidence_status ON evidence_item(status);
CREATE INDEX idx_audit_entity ON audit_log(entity_type, entity_id);
CREATE INDEX idx_audit_campaign ON audit_log(campaign_id);
CREATE INDEX idx_audit_timestamp ON audit_log(timestamp DESC);

-- å¾…å¤„ç†æé†’
CREATE INDEX idx_request_reminder ON request(status, deadline, reminder_count)
  WHERE status IN ('SENT', 'IN_PROGRESS', 'PARTIAL', 'OVERDUE');
```

---

## 5. API â€” ä¸»è¦ç«¯ç‚¹

### 5.1 Campaigns (æ´»åŠ¨)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `POST` | `/api/campaigns` | åˆ›å»ºæ–°æ´»åŠ¨ |
| `GET` | `/api/campaigns` | åˆ—å‡ºæ´»åŠ¨ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰ |
| `GET` | `/api/campaigns/:id` | æ´»åŠ¨è¯¦æƒ… |
| `PUT` | `/api/campaigns/:id` | æ›´æ–°æ´»åŠ¨ï¼ˆä»…é™è‰ç¨¿çŠ¶æ€ï¼‰ |
| `POST` | `/api/campaigns/:id/activate` | æ¿€æ´»æ´»åŠ¨ |
| `GET` | `/api/campaigns/:id/dashboard` | æ´»åŠ¨çš„ KPI å’Œç»Ÿè®¡æ•°æ® |
| `GET` | `/api/campaigns/:id/report` | ä¸‹è½½å®Œæ•´æŠ¥å‘Š |

### 5.2 Requests (è¯·æ±‚)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `POST` | `/api/campaigns/:id/requests` | åˆ›å»ºè¯·æ±‚ï¼ˆæ‰¹é‡ï¼‰ |
| `GET` | `/api/campaigns/:id/requests` | åˆ—å‡ºæŸæ´»åŠ¨çš„è¯·æ±‚ |
| `GET` | `/api/requests/:id` | è¯·æ±‚è¯¦æƒ… |
| `PUT` | `/api/requests/:id` | æ›´æ–°è¯·æ±‚ï¼ˆä»…é™è‰ç¨¿çŠ¶æ€ï¼‰ |
| `POST` | `/api/requests/:id/send` | å‘é€è¯·æ±‚ï¼ˆè§¦å‘ Power Automateï¼‰ |
| `POST` | `/api/requests/:id/close` | å…³é—­è¯·æ±‚ |
| `GET` | `/api/requests/pending-reminders` | éœ€è¦æé†’çš„è¯·æ±‚ |
| `POST` | `/api/requests/:id/reminder-sent` | è®°å½•å·²å‘é€çš„æé†’ |

### 5.3 Evidence Items (å‡­è¯é¡¹)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `GET` | `/api/requests/:id/evidences` | åˆ—å‡ºè¯·æ±‚çš„å‡­è¯ |
| `POST` | `/api/evidences/:id/validate` | éªŒè¯å‡­è¯ |
| `POST` | `/api/evidences/:id/reject` | æ‹’ç»å‡­è¯ï¼ˆå¿…é¡»å¡«å†™ç†ç”±ï¼‰ |

### 5.4 æ¥æ”¶äººé—¨æˆ· (å‡­è¯åŒ–è®¿é—®)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `GET` | `/api/submit/:token` | è®¿é—®ä¸Šä¼ é—¨æˆ· |
| `POST` | `/api/submit/:token/verify-otp` | éªŒè¯ OTP |
| `POST` | `/api/submit/:token/upload` | ä¸Šä¼ æ–‡ä»¶ / æ–‡æœ¬ |
| `GET` | `/api/submit/:token/status` | æŸ¥çœ‹å‡­è¯å½“å‰çŠ¶æ€ |

### 5.5 è®¤è¯ä¸ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `POST` | `/api/auth/login` | ç™»å½• (é‚®ç®± + å¯†ç  æˆ– OTP) |
| `POST` | `/api/auth/refresh` | åˆ·æ–°ä¼šè¯ä»¤ç‰Œ |
| `GET` | `/api/audit-logs` | æŸ¥è¯¢å®¡è®¡æ—¥å¿— |
| `GET` | `/api/users` | åˆ—å‡ºç³»ç»Ÿç”¨æˆ· |

---

## 6. Power Automate æµç¨‹ â€” è¯¦ç»†è®¾è®¡

### 6.1 Flow 1 â€” å‘é€åˆå§‹è¯·æ±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘å™¨: HTTP Request (POST)                     â”‚
â”‚  URL: https://prod-xx...logic.azure.com/...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  è¾“å…¥ Schema:                                    â”‚
â”‚  {                                               â”‚
â”‚    "to": "manager@firma.com",                    â”‚
â”‚    "cc": "delegado@firma.com",                   â”‚
â”‚    "subject": "[HR-FCTRL-1] Solicitud REQ-001", â”‚
â”‚    "body_html": "<html>...",                    â”‚
â”‚    "importance": "High",                         â”‚
â”‚    "request_id": "REQ-001",                      â”‚
â”‚    "control_code": "HR-FCTRL-1"                  â”‚
â”‚  }                                               â”‚
â”‚                                                  â”‚
â”‚  æ“ä½œ (Actions):                                 â”‚
â”‚  1. è§£æ JSON                                    â”‚
â”‚  2. Send an email (V2) â€” Outlook è¿æ¥å™¨          â”‚
â”‚     â€¢ From: controlinterno@firma.com             â”‚
â”‚       (å…±äº«é‚®ç®±æˆ–åˆ›å»ºè€…è´¦æˆ·)                      â”‚
â”‚     â€¢ To: @{triggerBody()?['to']}               â”‚
â”‚     â€¢ CC: @{triggerBody()?['cc']}               â”‚
â”‚     â€¢ Subject: @{triggerBody()?['subject']}     â”‚
â”‚     â€¢ Body: @{triggerBody()?['body_html']}      â”‚
â”‚     â€¢ Importance: @{triggerBody()?['importance']}â”‚
â”‚  3. Response (200 OK)                            â”‚
â”‚     { "status": "sent", "messageId": "..." }    â”‚
â”‚                                                  â”‚
â”‚  é”™è¯¯å¤„ç†:                                       â”‚
â”‚  â€¢ Scope try/catch                               â”‚
â”‚  â€¢ å¤±è´¥æ—¶: Response 500 å¹¶é™„å¸¦é”™è¯¯è¯¦æƒ…            â”‚
â”‚  â€¢ é‡è¯•ç­–ç•¥: 3 æ¬¡å°è¯•ï¼ŒæŒ‡æ•°é€€é¿                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Flow 2 â€” å‘é€ OTP (å¯é€‰)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘å™¨: HTTP Request (POST)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥: { "email": "...", "otp_code": "482917" }  â”‚
â”‚                                                  â”‚
â”‚  æ“ä½œ:                                           â”‚
â”‚  1. å‘é€å¸¦æœ‰ OTP æ¨¡æ¿çš„é‚®ä»¶                       â”‚
â”‚     Subject: éªŒè¯ç                               â”‚
â”‚     Body: æ‚¨çš„ä»£ç æ˜¯: {{otp_code}}               â”‚
â”‚           10åˆ†é’Ÿå†…æœ‰æ•ˆã€‚                         â”‚
â”‚  2. Response 200 OK                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Flow 3 â€” æé†’ä¸å‡çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘å™¨: Recurrence (æ¯å¤©, 08:00 CET)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  æ“ä½œ:                                           â”‚
â”‚  1. HTTP GET â†’ åç«¯ API                          â”‚
â”‚     /api/requests/pending-reminders              â”‚
â”‚     è¿”å›: éœ€è¦æé†’çš„è¯·æ±‚æ•°ç»„                      â”‚
â”‚                                                  â”‚
â”‚  2. Apply to each (å¯¹æ¯ä¸ªè¯·æ±‚):                   â”‚
â”‚     a. Switch on escalation_level (å‡çº§çº§åˆ«):    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚        â”‚ Level 1: To = ä»…æ¥æ”¶äºº                 â”‚ â”‚
â”‚        â”‚ Level 2: To = æ¥æ”¶äºº, CC = ä»£è¡¨        â”‚ â”‚
â”‚        â”‚ Level 3: To = æ¥æ”¶äºº, CC = åˆä¼™äºº      â”‚ â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚     b. Send Email (V2) â€” æé†’æ¨¡æ¿                â”‚
â”‚     c. HTTP POST â†’ åç«¯ API                      â”‚
â”‚        /api/requests/{id}/reminder-sent          â”‚
â”‚        Body: { "level": X, "sent_at": "..." }   â”‚
â”‚                                                  â”‚
â”‚  é¢‘ç‡: æ¯å¤© 08:00 CET                            â”‚
â”‚  å¹¶å‘: 1 (é¡ºåºæ‰§è¡Œ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 Flow 4 â€” å‡­è¯å½’æ¡£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘å™¨: HTTP Request (POST)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  è¾“å…¥ Schema:                                    â”‚
â”‚  {                                               â”‚
â”‚    "file_content_base64": "...",                  â”‚
â”‚    "file_name": "Balance_2025.xlsx",             â”‚
â”‚    "folder_path": "/HR-FCTRL-1/CAMP-001/...",   â”‚
â”‚    "metadata": {                                 â”‚
â”‚      "request_id": "REQ-001",                    â”‚
â”‚      "evidence_id": "EV-003",                    â”‚
â”‚      "uploaded_by": "jgarcia@firma.com",         â”‚
â”‚      "uploaded_at": "2026-02-19T14:30:00Z"       â”‚
â”‚    }                                             â”‚
â”‚  }                                               â”‚
â”‚                                                  â”‚
â”‚  æ“ä½œ:                                           â”‚
â”‚  1. Create folder (å¦‚æœä¸å­˜åœ¨) â€” SharePoint       â”‚
â”‚     Site: tuempresa.sharepoint.com/sites/...     â”‚
â”‚     Path: /Evidencias/{{folder_path}}            â”‚
â”‚                                                  â”‚
â”‚  2. Create file â€” SharePoint è¿æ¥å™¨              â”‚
â”‚     Folder: /Evidencias/{{folder_path}}          â”‚
â”‚     File Name: {{file_name}}                     â”‚
â”‚     Content: base64ToBinary(file_content_base64) â”‚
â”‚                                                  â”‚
â”‚  3. Update file properties â€” SharePoint          â”‚
â”‚     è®¾ç½®å…ƒæ•°æ®åˆ—ï¼ˆå¦‚æœå·²é…ç½®ï¼‰                    â”‚
â”‚                                                  â”‚
â”‚  4. Response 200 OK                              â”‚
â”‚     {                                            â”‚
â”‚       "status": "archived",                      â”‚
â”‚       "sp_path": "/Evidencias/...",              â”‚
â”‚       "sp_url": "https://...",                   â”‚
â”‚       "sp_item_id": "..."                        â”‚
â”‚     }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. è®¤è¯ä¸æˆæƒ

### 7.1 åŒé‡è®¤è¯æ¨¡å‹

ç³»ç»Ÿå¤„ç†**ä¸¤ç§ç±»å‹çš„è®¿é—®**ï¼Œé‡‡ç”¨ä¸åŒçš„æœºåˆ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åŒé‡è®¤è¯                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         å‘èµ·äºº (å†…éƒ¨)         â”‚      æ¥æ”¶äºº (é“¾æ¥)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                  â”‚
â”‚  é‚®ç®± + å¯†ç                   â”‚  URL ä¸­çš„ç­¾åä»¤ç‰Œ                 â”‚
â”‚  (æˆ–é‚®ç®±é­”æœ¯é“¾æ¥)             â”‚  + é‚®ä»¶ OTP (å¯é€‰)               â”‚
â”‚                              â”‚                                  â”‚
â”‚  ä¼šè¯: JWT (httpOnly         â”‚  ä¼šè¯: ä¸´æ—¶ä¼šè¯ä»¤ç‰Œ               â”‚
â”‚  cookie, 8h æœ‰æ•ˆæœŸ)          â”‚  (30 åˆ†é’Ÿ)                       â”‚
â”‚                              â”‚                                  â”‚
â”‚  è®¿é—®: æ‰€æœ‰è‡ªå·±çš„             â”‚  è®¿é—®: ä»…é™å…¶ç‰¹å®šè¯·æ±‚             â”‚
â”‚  æ´»åŠ¨ + ç®¡ç†å‘˜æƒé™(å¦‚é€‚ç”¨)    â”‚  (è¯»å– + ä¸Šä¼ )                   â”‚
â”‚                              â”‚                                  â”‚
â”‚  RBAC: æ‹¥æœ‰è€…, ç®¡ç†å‘˜,        â”‚  æƒé™: ä¸Šä¼ , æŸ¥çœ‹                â”‚
â”‚  æŸ¥çœ‹è€…                      â”‚  (ä¸å¯ç¼–è¾‘é…ç½®)                   â”‚
â”‚                              â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ¥æ”¶äººä»¤ç‰Œç”Ÿæˆ

```javascript
// ä¼ªä»£ç  â€” ç”Ÿæˆç­¾åä»¤ç‰Œ
function generateRequestToken(requestId, recipientEmail) {
  const payload = {
    sub: requestId,
    email: recipientEmail,
    iat: Date.now(),
    exp: Date.now() + (TOKEN_EXPIRY_DAYS * 86400000),
    jti: crypto.randomUUID()  // ä»¤ç‰Œå”¯ä¸€æ ‡è¯†ç¬¦
  };
  
  return jwt.sign(payload, APP_SECRET_KEY, { algorithm: 'HS256' });
}

// æ¥æ”¶äººè®¿é—® URL
const accessUrl = `${APP_BASE_URL}/submit/${token}`;
```

### 7.3 OTP æµç¨‹ (å¯é€‰ä½†æ¨è)

```
æ¥æ”¶äºº                  åç«¯                 Power Automate        Outlook
     â”‚                     â”‚                      â”‚                  â”‚
     â”‚  GET /submit/:token â”‚                      â”‚                  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                  â”‚
     â”‚                     â”‚ éªŒè¯ä»¤ç‰Œ              â”‚                  â”‚
     â”‚                     â”‚ ç”Ÿæˆ OTP (6ä½æ•°å­—)    â”‚                  â”‚
     â”‚                     â”‚                      â”‚                  â”‚
     â”‚  "è¾“å…¥ OTP"         â”‚ POST /send-otp       â”‚                  â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ å‘é€é‚®ä»¶          â”‚
     â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                      â”‚                  â”‚ â†’ æ”¶ä»¶ç®±
     â”‚  POST /verify-otp   â”‚                      â”‚                  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                  â”‚
     â”‚                     â”‚ éªŒè¯ OTP             â”‚                  â”‚
     â”‚  âœ… è®¿é—®æˆæƒ         â”‚                      â”‚                  â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                  â”‚
```

### 7.4 è§’è‰²ä¸æƒé™ (RBAC)

| è§’è‰² | åˆ›å»ºæ´»åŠ¨ | æŸ¥çœ‹æ´»åŠ¨ | å‘é€è¯·æ±‚ | éªŒè¯å‡­è¯ | ç®¡ç†å‘˜ |
|---|---|---|---|---|---|
| **Owner (æ‹¥æœ‰è€…)** | âœ… | è‡ªå·±çš„ | âœ… | âœ… | âŒ |
| **Admin (ç®¡ç†å‘˜)** | âœ… | æ‰€æœ‰ | âœ… | âœ… | âœ… |
| **Viewer (æŸ¥çœ‹è€…)** | âŒ | è¢«åˆ†é…çš„ | âŒ | âŒ | âŒ |
| **Destinatario (æ¥æ”¶äºº)** | âŒ | ä»…é™å…¶è¯·æ±‚ | âŒ | âŒ | âŒ |

---

## 8. å­˜å‚¨ä¸å½’æ¡£

### 8.1 åŒé‡å­˜å‚¨ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åŒé‡å­˜å‚¨                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ä¸´æ—¶ (åç«¯)                â”‚    æ°¸ä¹… (SharePoint)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                   â”‚
â”‚  â€¢ ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨æœåŠ¡å™¨     â”‚  â€¢ éªŒè¯å‡­è¯åï¼Œé€šè¿‡               â”‚
â”‚    ç£ç›˜/ä¸´æ—¶ Blob ä¸­          â”‚    Power Automate Flow 4          â”‚
â”‚                              â”‚    å½’æ¡£åˆ° SharePoint              â”‚
â”‚                              â”‚                                   â”‚
â”‚  â€¢ æœ€é•¿ä¿ç•™ 90 å¤©            â”‚  â€¢ æ ¹æ®å…¬å¸æ”¿ç­–ä¿ç•™                â”‚
â”‚                              â”‚    (7 å¹´+)                        â”‚
â”‚  â€¢ æˆåŠŸå½’æ¡£åˆ° SharePoint     â”‚                                   â”‚
â”‚    ååˆ é™¤                    â”‚  â€¢ æ ‡å‡†åŒ–ç»“æ„                      â”‚
â”‚                              â”‚    æŒ‰æ§åˆ¶/æ´»åŠ¨/è¯·æ±‚ç»„ç»‡            â”‚
â”‚  â€¢ å¤‡ä»½: Azure Blob          â”‚                                   â”‚
â”‚    Storage (å¯é€‰)            â”‚  â€¢ å¯å®¡è®¡å’Œç‰ˆæœ¬åŒ–çš„è®¿é—®            â”‚
â”‚                              â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 SharePoint æ–‡ä»¶å¤¹ç»“æ„

```
ğŸ“ Site: /sites/EvidenciasControl
â””â”€â”€ ğŸ“š Library: Evidencias
    â”œâ”€â”€ ğŸ“ HR-FCTRL-1/                              â† æ§åˆ¶ä»£ç 
    â”‚   â”œâ”€â”€ ğŸ“ CAMP-2026-001_RevisiÃ³n_Anual/        â† æ´»åŠ¨
    â”‚   â”‚   â”œâ”€â”€ ğŸ“ REQ-001_jgarcia/                 â† è¯·æ±‚
    â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EV001_Balance_Anual_2025.xlsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EV002_Acta_ReuniÃ³n_Dic.pdf
    â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EV003_Acceso_SAP_screenshot.png
    â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ _metadata.json
    â”‚   â”‚   â”œâ”€â”€ ğŸ“ REQ-002_mlopez/
    â”‚   â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Campaign_Report_CAMP-2026-001.pdf
    â”‚   â”‚   â””â”€â”€ ğŸ“„ Campaign_Summary.xlsx
    â”‚   â””â”€â”€ ğŸ“ CAMP-2026-002_Control_Trimestral/
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ ğŸ“ FIN-CTRL-3/
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ğŸ“ _TEMPLATES/                              â† é‚®ä»¶æ¨¡æ¿
        â”œâ”€â”€ ğŸ“„ initial_request.html
        â”œâ”€â”€ ğŸ“„ reminder_l1.html
        â”œâ”€â”€ ğŸ“„ reminder_l2.html
        â”œâ”€â”€ ğŸ“„ reminder_l3.html
        â””â”€â”€ ğŸ“„ close_notification.html
```

### 8.3 å½’æ¡£å…ƒæ•°æ® (_metadata.json)

```json
{
  "request_id": "REQ-001",
  "campaign_id": "CAMP-2026-001",
  "control_code": "HR-FCTRL-1",
  "recipient": "jgarcia@firma.com",
  "evidences": [
    {
      "evidence_id": "EV001",
      "name": "Balance Anual 2025",
      "file": "EV001_Balance_Anual_2025.xlsx",
      "status": "VALIDATED",
      "submitted_at": "2026-02-15T10:30:00Z",
      "validated_at": "2026-02-16T09:00:00Z",
      "validated_by": "asmith@firma.com"
    }
  ],
  "timeline": {
    "sent_at": "2026-02-10T08:00:00Z",
    "first_submission_at": "2026-02-12T14:22:00Z",
    "completed_at": "2026-02-15T10:30:00Z",
    "closed_at": "2026-02-16T09:15:00Z"
  },
  "reminders_sent": 1
}
```

---

## 9. ç»„ä»¶é—´é€šä¿¡

### 9.1 é€šä¿¡åè®®

```
å‰ç«¯    â†â”€â”€â”€â”€ HTTPS/REST (JSON) â”€â”€â”€â”€â†’ åç«¯
åç«¯    â†â”€â”€â”€â”€ HTTPS/Webhook (JSON) â”€â”€â†’ Power Automate
Power Automate â†â”€â”€ Outlook è¿æ¥å™¨ â”€â”€â†’ é‚®ç®±
Power Automate â†â”€â”€ SharePoint è¿æ¥å™¨ â†’ SharePoint
```

### 9.2 ç¤ºä¾‹ Payload â€” åç«¯ â†’ Power Automate (Flow 1)

```json
{
  "to": "jgarcia@firma.com",
  "cc": "delegado@firma.com",
  "subject": "[HR-FCTRL-1] Solicitud de documentaciÃ³n REQ-001",
  "body_html": "<html><body>...<a href='https://app.firma.com/submit/eyJhbGci...'>è®¿é—®è¯·æ±‚</a>...</body></html>",
  "importance": "High",
  "request_id": "REQ-001",
  "control_code": "HR-FCTRL-1"
}
```

### 9.3 å›è°ƒ â€” Power Automate â†’ åç«¯ (Flow 3 æé†’)

```json
POST /api/requests/REQ-001/reminder-sent
{
  "level": 2,
  "sent_at": "2026-02-19T08:00:00Z",
  "sent_to": "jgarcia@firma.com",
  "cc": "delegado@firma.com"
}
```

---

## 10. çŠ¶æ€ä¸çŠ¶æ€æœº

### 10.1 çŠ¶æ€æœº â€” Campaign (æ´»åŠ¨)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         create â”€â”€> â”‚  DRAFT   â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ activate
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ACTIVE  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ all requests closed
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  COMPLETED   â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ archive (manual)
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ARCHIVED â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 çŠ¶æ€æœº â€” Request (è¯·æ±‚)

```
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    create â”€â”€> â”‚  DRAFT   â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”‚ send
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   SENT   â”‚â”€â”€â”€â”€â”€>â”‚  OVERDUE  â”‚ (å¦‚ deadline < now)
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ first upload
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ IN_PROGRESS  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
                    â”‚ partial upload                             â”‚
                    â–¼                                            â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
               â”‚ PARTIAL  â”‚                                     â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
                    â”‚ all items submitted                        â”‚
                    â–¼                                            â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
               â”‚  SUBMITTED   â”‚                                 â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
                    â”‚ under review                              â”‚
                    â–¼                                            â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      reject    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
               â”‚  REVIEW  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ SUBSANACIÃ“N  â”‚â”€â”€â”€â”€â”˜
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ all mandatory validated
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ READY_TO_CLOSE   â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ confirm close
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  CLOSED  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 çŠ¶æ€æœº â€” Evidence Item (å‡­è¯é¡¹)

```
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    create â”€â”€> â”‚ PENDING  â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
                    â”‚ upload              â”‚ subsanaciÃ³n (è¡¥æ­£)
                    â–¼                     â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
               â”‚  SUBMITTED   â”‚          â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                    â”‚                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”             â”‚
              â–¼            â–¼             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
        â”‚ VALIDATED â”‚ â”‚ REJECTED â”‚â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. æ¶æ„å†³ç­– (ADR)

### ADR-001: Power Automate ä½œä¸ºä¸ Microsoft 365 çš„é›†æˆå±‚

**èƒŒæ™¯:** ç»„ç»‡æ²¡æœ‰ Azure AD æƒé™æ¥æ³¨å†Œåº”ç”¨ç¨‹åºæˆ–è®¿é—® Graph APIã€‚

**å†³ç­–:** ä½¿ç”¨ Power Automate ä½œä¸ºæˆæƒä¸­é—´äººï¼Œé€šè¿‡ Outlook å‘é€é‚®ä»¶å¹¶åœ¨ SharePoint ä¸­å½’æ¡£æ–‡ä»¶ã€‚

**åæœ:**
- âœ… ä¸éœ€è¦å…¨çƒ IT æƒé™
- âœ… ä½¿ç”¨æµåˆ›å»ºè€…çš„å‡­æ®
- âœ… HTTP è§¦å‘å™¨ä½¿é›†æˆå˜å¾—ç®€å•
- âš ï¸ é‚®ä»¶ä»åˆ›å»ºè€…çš„è´¦æˆ·ï¼ˆæˆ–å…±äº«é‚®ç®±ï¼‰å‘é€
- âš ï¸ ä¾èµ– Power Automate çš„å¯ç”¨æ€§
- âš ï¸ æ‰§è¡Œé™åˆ¶å–å†³äºè®¸å¯è¯ (5,000-10,000+/å¤©)

---

### ADR-002: ç­¾åä»¤ç‰Œ + OTP ä»£æ›¿ SSO

**èƒŒæ™¯:** æ— å¯ç”¨ SSOï¼Œéœ€è¦ä¸€ç§é’ˆå¯¹å¤–éƒ¨æ¥æ”¶äººçš„è®¤è¯æœºåˆ¶ã€‚

**å†³ç­–:** ç”ŸæˆåŒ…å«åœ¨è®¿é—® URL ä¸­çš„ JWT/HMAC ç­¾åä»¤ç‰Œï¼Œå¯é€‰ OTP ä½œä¸ºç¬¬äºŒå› ç´ ã€‚

**åæœ:**
- âœ… ä¸éœ€è¦æ¥æ”¶äººåœ¨åº”ç”¨ä¸­æ‹¥æœ‰è´¦æˆ·
- âœ… ä»é‚®ä»¶ç›´æ¥é“¾æ¥
- âœ… OTP å¢åŠ äº†ä¸€å±‚å®‰å…¨ä¿æŠ¤ä¸”ä¸è¿‡åº¦ç¹ç
- âš ï¸ ä»¤ç‰Œå¯èƒ½è¢«è½¬å‘ (é€šè¿‡ OTP ç¼“è§£)
- âš ï¸ éœ€è¦ç®¡ç†è¿‡æœŸå’Œåˆ·æ–°

---

### ADR-003: PostgreSQL ä½œä¸ºä¸»æ•°æ®åº“

**èƒŒæ™¯:** éœ€è¦å…·æœ‰çµæ´»æ•°æ® (JSONB) æ”¯æŒå’Œå¼ºå¤§å®¡è®¡åŠŸèƒ½çš„å…³ç³»å‹å­˜å‚¨ã€‚

**å†³ç­–:** ä½¿ç”¨ PostgreSQL ä½œä¸ºç³»ç»Ÿçš„å”¯ä¸€æ•°æ®åº“ã€‚

**åæœ:**
- âœ… ACID åˆè§„æ€§ç¡®ä¿å®¡è®¡æ—¥å¿—çš„å®Œæ•´æ€§
- âœ… ç”¨äºçµæ´»ç­–ç•¥å’Œå…ƒæ•°æ®çš„ JSONB
- âœ… å¹¿æ³›çš„å·¥å…·å’Œæ‰˜ç®¡ç”Ÿæ€ç³»ç»Ÿ
- âš ï¸ éœ€è¦ç»´æŠ¤æ•°æ®åº“æœåŠ¡å™¨

---

### ADR-004: åŒé‡å­˜å‚¨ (æœåŠ¡å™¨ä¸´æ—¶ + SharePoint æ°¸ä¹…)

**èƒŒæ™¯:** ä¸Šä¼ çš„æ–‡ä»¶å¿…é¡»å¯ç«‹å³ç”¨äºå®¡æŸ¥ï¼Œä½†é•¿æœŸå½’æ¡£äº SharePointã€‚

**å†³ç­–:** æ–‡ä»¶ä¸´æ—¶ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼ŒéªŒè¯åé€šè¿‡ Power Automate å½’æ¡£åˆ° SharePointã€‚

**åæœ:**
- âœ… å®¡æŸ¥è¿‡ç¨‹ä¸­è®¿é—®é€Ÿåº¦å¿«
- âœ… SharePoint ä¸­æ ‡å‡†åŒ–å½’æ¡£ä»¥ç¡®ä¿å­˜å‚¨åˆè§„
- âš ï¸ éœ€è¦å®šæœŸåŒæ­¥å’Œæ¸…ç†ä¸´æ—¶å­˜å‚¨

---

### ADR-005: "æ´»åŠ¨ä¼˜å…ˆ" (Campaign-first) è®¾è®¡

**èƒŒæ™¯:** å†…éƒ¨æ§åˆ¶é€šå¸¸åœ¨åŒä¸€ä¸ªæ§åˆ¶æ´»åŠ¨ä¸‹åˆ†ç»„å¤šä¸ªè¯·æ±‚ã€‚

**å†³ç­–:** æ‰€æœ‰è¯·æ±‚éƒ½åˆ†ç»„åœ¨ä¸€ä¸ªæ´»åŠ¨ä¸­ï¼Œä¸å­˜åœ¨å­¤ç«‹è¯·æ±‚ã€‚

**åæœ:**
- âœ… æŒ‰æ§åˆ¶é¡¹ç›®çš„å…¨å±€è§†å›¾
- âœ… æ´»åŠ¨çº§åˆ«çš„æŠ¥å‘Šå’Œ KPI
- âœ… æ—¥æœŸã€æ”¿ç­–å’Œæ²Ÿé€šçš„ä¸€è‡´æ€§
- âš ï¸ å³ä½¿æ˜¯å¯¹å•æ¬¡è¯·æ±‚ä¹Ÿéœ€è¦åˆ›å»ºæ´»åŠ¨

---

## 12. å¤‡é€‰æ–¹æ¡ˆè¯„ä¼°

### 12.1 å¤‡é€‰ â€” 100% Power Apps + SharePoint Lists

| æ–¹é¢ | è¯„ä¼° |
|---|---|
| å¯è¡Œæ€§ | âœ… é«˜ (å…¨éƒ¨åœ¨ Microsoft ç”Ÿæ€ä¸­) |
| UX / ä¸ªæ€§åŒ– | âš ï¸ æœ‰é™ (Power Apps æœ‰è®¾è®¡é™åˆ¶) |
| æ€§èƒ½ | âš ï¸ SharePoint Lists æœ‰ 5,000+ æ¡ç›®é™åˆ¶ |
| å¯æ‰©å±•æ€§ | âŒ éš¾ä»¥åº”å¯¹é«˜å®¹é‡ |
| é€»è¾‘å¤æ‚æ€§ | âš ï¸ å¤æ‚æµç¨‹åœ¨ Power Automate ä¸­éš¾ä»¥ç»´æŠ¤ |
| **ç»“è®º** | é€‚åˆ MVP/PoCï¼Œä¸æ¨èç”¨äºç”Ÿäº§ |

### 12.2 å¤‡é€‰ â€” Microsoft Forms + Power Automate

| æ–¹é¢ | è¯„ä¼° |
|---|---|
| å¯è¡Œæ€§ | âœ… å¿«é€Ÿå®æ–½ |
| ä¸ªæ€§åŒ– | âŒ éå¸¸æœ‰é™ |
| ä¸ªäººè·Ÿè¸ª | âŒ Forms åŸç”Ÿä¸æ”¯æŒä¸ªäººè¯·æ±‚ |
| éªŒè¯ | âŒ æ²¡æœ‰éªŒè¯/æ‹’ç»æµç¨‹ |
| **ç»“è®º** | ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ |

### 12.3 å¤‡é€‰ â€” Azure Functions + Graph API (å¸¦åº”ç”¨æ³¨å†Œ)

| æ–¹é¢ | è¯„ä¼° |
|---|---|
| å¯è¡Œæ€§ | âŒ éœ€è¦ä¸å¯ç”¨çš„ Azure AD æƒé™ |
| UX / ä¸ªæ€§åŒ– | âœ… å®Œå…¨ |
| æ€§èƒ½ | âœ… ä¼˜ç§€ |
| **ç»“è®º** | æŠ€æœ¯ä¸Šç†æƒ³ï¼Œä½†å—ç»„ç»‡é™åˆ¶é˜»ç¢ |

### 12.4 å¤‡é€‰ â€” å¤–éƒ¨å¹³å° (Jira, ServiceNow ç­‰)

| æ–¹é¢ | è¯„ä¼° |
|---|---|
| å¯è¡Œæ€§ | âš ï¸ å–å†³äºå¯ç”¨è®¸å¯è¯ |
| é€‚åº”æ€§ | âŒ è®¾è®¡ç”¨äºå·¥å•ç®¡ç†ï¼Œè€Œéè¯æ®æ”¶é›† |
| æˆæœ¬ | âŒ é«˜ (æŒ‰ç”¨æˆ·é¢å¤–è®¸å¯) |
| **ç»“è®º** | è§„æ¨¡è¿‡å¤§ä¸”ä¸é€‚åº”ä½¿ç”¨åœºæ™¯ |

---

## 13. éåŠŸèƒ½æ€§éœ€æ±‚

### 13.1 æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡ |
|---|---|
| é¡µé¢åŠ è½½æ—¶é—´ | < 2 ç§’ |
| API å“åº”æ—¶é—´ | < 500ms (p95) |
| æ–‡ä»¶ä¸Šä¼  (50MB) | < 30 ç§’ |
| PDF æŠ¥å‘Šç”Ÿæˆ | < 10 ç§’ |
| é‚®ä»¶å‘é€ (Power Automate) | < 5 ç§’ (ç«¯åˆ°ç«¯) |

### 13.2 å¯ç”¨æ€§

| æŒ‡æ ‡ | ç›®æ ‡ |
|---|---|
| æœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ—¶é—´ | 99.5% (å·¥ä½œæ—¶é—´) |
| RPO (æ¢å¤ç‚¹ç›®æ ‡) | 1 å°æ—¶ |
| RTO (æ¢å¤æ—¶é—´ç›®æ ‡) | 4 å°æ—¶ |
| æ•°æ®åº“å¤‡ä»½ | æ¯æ—¥ï¼Œä¿ç•™ 30 å¤© |

### 13.3 å¯æ‰©å±•æ€§

| æŒ‡æ ‡ | æœ€å°å®¹é‡ |
|---|---|
| åŒæ—¶æ´»è·ƒæ´»åŠ¨ | 50+ |
| æ¯ä¸ªæ´»åŠ¨çš„è¯·æ±‚æ•° | 500+ |
| å¹¶å‘å‘èµ·ç”¨æˆ· | 20+ |
| å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å° | 100 MB |
| SharePoint æ€»å­˜å‚¨ | å–å†³äº M365 è®¡åˆ’ (1TB+) |

### 13.4 å®‰å…¨æ€§

| æ§åˆ¶ | å®æ–½ |
|---|---|
| åŠ å¯†é€šä¿¡ | HTTPS / TLS 1.3 |
| ç­¾åä»¤ç‰Œ | JWT with HS256 / RS256 |
| é€Ÿç‡é™åˆ¶ | å…¬å…±ç«¯ç‚¹æ¯ IP 100 req/min |
| æ–‡ä»¶éªŒè¯ | MIME ç±»å‹ + æ‰©å±•å + æœ€å¤§å¤§å° |
| SQL æ³¨å…¥ | å¸¦å‚æ•°åŒ–æŸ¥è¯¢çš„ ORM |
| XSS | è¾“å…¥æ¸…ç† + CSP å¤´ |
| CSRF | è¡¨å•ä¸­çš„ CSRF ä»¤ç‰Œ |
| å®¡è®¡è·Ÿè¸ª | audit_log è¡¨ä¸­çš„ä¸å¯å˜è®°å½• |

### 13.5 å…¼å®¹æ€§

| æµè§ˆå™¨/ç¯å¢ƒ | æœ€ä½ç‰ˆæœ¬ |
|---|---|
| Chrome / Edge | æœ€è¿‘ 2 ä¸ªç‰ˆæœ¬ |
| Firefox | æœ€è¿‘ 2 ä¸ªç‰ˆæœ¬ |
| Safari | æœ€è¿‘ 2 ä¸ªç‰ˆæœ¬ |
| ç§»åŠ¨ç«¯ (å“åº”å¼) | iOS Safari 15+, Chrome Android |

---

## 14. éƒ¨ç½²è®¡åˆ’

### 14.1 ç¯å¢ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEV (æœ¬åœ°)      â”‚  STAGING (é¢„å‘å¸ƒ)      â”‚  PRODUCTION (ç”Ÿäº§)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  localhost:3000   â”‚  staging.firma.com    â”‚  app.firma.com      â”‚
â”‚  SQLite / PG     â”‚  PostgreSQL           â”‚  PostgreSQL (Azure) â”‚
â”‚  Mock PA flows   â”‚  PA flows (test)      â”‚  PA flows (prod)    â”‚
â”‚  Mailhog         â”‚  Test mailbox         â”‚  Shared mailbox     â”‚
â”‚  Local storage   â”‚  SP test site         â”‚  SP production site â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14.2 CI/CD ç®¡é“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Commit  â”‚â”€â”€â”€>â”‚  Build   â”‚â”€â”€â”€>â”‚  Test    â”‚â”€â”€â”€>â”‚  Stage   â”‚â”€â”€â”€>â”‚  Prod    â”‚
â”‚  (Git)   â”‚    â”‚  (CI)    â”‚    â”‚  (CI)    â”‚    â”‚  Deploy  â”‚    â”‚  Deploy  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â€¢ lint          â€¢ unit tests    â€¢ auto          â€¢ manual
                 â€¢ typecheck     â€¢ integration   â€¢ smoke test    â€¢ approval
                 â€¢ build         â€¢ API tests     â€¢ PA flow test  â€¢ rollback
                                                                   plan
```

### 14.3 Docker (ç”Ÿäº§)

```dockerfile
# Dockerfile ç¤ºä¾‹
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["node", "dist/server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    env_file: .env
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: postgres:16-alpine
    volumes:
      - pgdata:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: doc_requests
      POSTGRES_USER: app_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    ports:
      - "5432:5432"
    restart: unless-stopped

volumes:
  pgdata:
```

---

## 15. å¯è§‚æµ‹æ€§ä¸ç›‘æ§

### 15.1 ç»“æ„åŒ–æ—¥å¿—

```json
{
  "timestamp": "2026-02-19T14:30:00.123Z",
  "level": "info",
  "service": "request-service",
  "action": "evidence_validated",
  "campaign_id": "CAMP-2026-001",
  "request_id": "REQ-001",
  "evidence_id": "EV-003",
  "actor": "asmith@firma.com",
  "duration_ms": 45
}
```

### 15.2 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç±»å‹ | æè¿° |
|---|---|---|
| `campaigns_active` | Gauge | æ´»è·ƒæ´»åŠ¨æ•° |
| `requests_by_status` | Gauge | æŒ‰çŠ¶æ€åˆ†ç±»çš„è¯·æ±‚ |
| `evidence_submission_time` | Histogram | æäº¤è€—æ—¶ |
| `pa_webhook_latency` | Histogram | Power Automate å»¶è¿Ÿ |
| `pa_webhook_errors` | Counter | Power Automate é”™è¯¯ |
| `reminder_sent_total` | Counter | å‘é€çš„æé†’æ€»æ•° |

### 15.3 è­¦æŠ¥

| è­¦æŠ¥ | æ¡ä»¶ | ä¸¥é‡æ€§ |
|---|---|---|
| PA Flow Error | 15åˆ†é’Ÿå†…é”™è¯¯ç‡ > 5% | ğŸ”´ ä¸¥é‡ |
| API High Latency | 5åˆ†é’Ÿå†… p95 > 2s | ğŸŸ¡ è­¦å‘Š |
| DB Connection Pool | > 80% åˆ©ç”¨ç‡ | ğŸŸ¡ è­¦å‘Š |
| Disk Space | ç©ºé—² < 10% | ğŸ”´ ä¸¥é‡ |
| Overdue Requests | æ— å“åº”è¯·æ±‚ > 15 å¤© | ğŸŸ¡ è­¦å‘Š |

---

## 16. é£é™©ä¸ç¼“è§£

| # | é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£ |
|---|---|---|---|---|
| R1 | Power Automate ä¸å¯ç”¨ | ä½ | é«˜ | é‡è¯•é˜Ÿåˆ—; ç›‘æ§è­¦æŠ¥; æ‰‹åŠ¨å¤‡ä»½æµç¨‹ |
| R2 | è¾¾åˆ° PA æ‰§è¡Œé™åˆ¶ | ä¸­ | ä¸­ | ç›‘æ§ä½¿ç”¨æƒ…å†µ; æ‰¹å¤„ç†; å¿…è¦æ—¶å‡çº§è®¸å¯è¯ |
| R3 | é“¾æ¥ä»¤ç‰Œæ³„éœ² | ä½ | ä¸­ | å¼ºåˆ¶ OTP; çŸ­è¿‡æœŸæ—¶é—´; è®°å½•å¸¦ IP çš„æ¯æ¬¡è®¿é—® |
| R4 | SharePoint å·²æ»¡ / æ— æ³•è®¿é—® | ä½ | é«˜ | ä¸´æ—¶å­˜å‚¨ä½œä¸ºå¤‡ç”¨; ç©ºé—´è­¦æŠ¥ |
| R5 | æ•°æ®åº“æ•°æ®ä¸¢å¤± | æä½ | ä¸¥é‡ | æ¯æ—¥å¤‡ä»½; å¤åˆ¶; æ¢å¤æµ‹è¯• |
| R6 | å…¨çƒ IT æ”¿ç­–å˜æ›´ | ä¸­ | é«˜ | æ¨¡å—åŒ–è®¾è®¡; ADR-001 å…è®¸è½»æ¾è¿ç§»åˆ° Graph API |
| R7 | æœ€ç»ˆç”¨æˆ·æ‹’ç»ä½¿ç”¨ | ä¸­ | é«˜ | ç®€å•çš„ UX; åŸ¹è®­; æ”¯æŒ; å°ç»„è¯•ç‚¹ |
| R8 | é‚®ä»¶è¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ | ä½ | ä¸­ | é…ç½®å…±äº«é‚®ç®±; SPF/DKIM; ä¼ä¸šå†…å®¹ |

---

<p align="center">
  <strong>Forvis Mazars</strong> Â· æŠ€æœ¯æ¶æ„ Â· v1.0<br>
  <em>ç³»ç»Ÿè®¾è®¡ä¸å®æ–½å‚è€ƒæ–‡æ¡£ã€‚</em>
</p>
